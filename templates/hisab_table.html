{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SANJEEV ROADLINES</title>
  <link rel="stylesheet" href="{% static 'css/hisab_table.css' %}">

</head>

<body>

  <!-- ===== Header Section ===== -->
  <div class="header">
    <img src="{% static 'image/logo.jfif' %}" alt="Company Logo">
    <h1>SANJEEV ROADLINES</h1>
  </div>

  <!-- Filter Section -->
  <div class="filter-section">
    <input type="date" id="filter-date" placeholder="Date" />
    <input type="text" id="filter-vehicle" placeholder="Vehicle No / Driver" />
    <input type="text" id="filter-location" placeholder="Location" />
    <button class="btn-search" onclick="applyFilters()">Search</button>
    <button class="btn-clear" onclick="clearFilters()">Clear</button>
  </div>

  <!-- table section -->
  <div class="table-wrapper">

    <table id="editableTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Vehicle No / Driver</th>
          <th>Location</th>
          <th>Weight In Tons</th>
          <th>Rate Per Ton</th>
          <th>Amount</th>
          <th>Deductions</th>
          <th>Final</th>
          <th style="text-align:center; vertical-align:middle;">
            <button class="add-row-btn" onclick="addRow()">+ Add Row</button>
          </th>

        </tr>
      </thead>
      <tbody id="hisab-table-body">
        {% for entry in entries %}
        <tr data-id="{{ entry.id }}">
          <td data-label="Date"><input type="date" value="{{ entry.date|date:'Y-m-d' }}" /></td>
          <td data-label="Vehicle No / Driver"><input type="text" class="truck_number"
              value="{{ entry.vehicle_driver }}" /></td>
          <td data-label="Location"><input type="text" class="location" value="{{ entry.location }}" /></td>
          <td data-label="Weight In Tons"><input type="text" class="weight" value="{{ entry.weight_tons }}"
              oninput="updateWeightDisplay(this)" /></td>
          <td data-label="Rate Per Ton"><input type="number" class="rate" value="{{ entry.rate_per_ton }}"
              oninput="updateAmount(this)" /></td>
          <td data-label="Amount"><input type="number" class="amount" value="{{ entry.amount }}" readonly /></td>
          <td data-label="Deductions">
            <div class="deduction-wrapper">
              <div class="deduction-input-group">
                <input type="text" class="deduction-input" onkeydown="handleDeductionKey(event)" placeholder="Enter" />
                <button class="toggle-btn" onclick="toggleDeductionList(this)">&#9662;</button>
              </div>
              <div class="deduction-container"></div>
              <input type="hidden" class="deduction-hidden" value='{{ entry.deductions|default:"[]" }}' />
            </div>
          </td>
          <td data-label="Final"><input type="number" class="final" value="{{ entry.final_amount }}" readonly /></td>
          <td data-label="Delete"><button class="delete-row-btn" onclick="deleteRow(this)">X</button></td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>


  <script src="{% static 'js/hisab_table.js' %}"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const table = document.getElementById("editableTable");
  if (!table) return;

  table.addEventListener("keydown", e => {
    if (e.key !== "Enter" || e.target.tagName === "TEXTAREA" || e.target.closest("button")) return;

    const inputs = [...table.querySelectorAll("input, select, textarea")]
      .filter(el => !el.disabled && el.type !== "hidden" && !el.readOnly && el.offsetParent !== null);

    const idx = inputs.indexOf(e.target);
    if (idx > -1 && idx < inputs.length - 1) {
      e.preventDefault();
      inputs[idx + 1].focus();
      inputs[idx + 1].select?.();
    }
  });
});
</script>


</body>

</html>

<!-- select * from hisab_app_transportentry  -->
<!-- Username (leave blank to use 'lenovo'): roshan
Email address: prajapatiroshan865@gmail.com
Password: roshan123 -->



